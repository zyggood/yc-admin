# Spring Modulith 后台管理系统开发计划

## 项目概述

基于 Spring Modulith 的企业级后台管理系统，采用模块化架构设计，提供完整的权限管理和系统监控功能。

### 技术栈
- Java 21
- Spring Boot 3.5.4
- Spring Modulith 1.4.1
- Spring Security
- Spring Data JPA + MyBatis
- Lombok

## 模块化架构设计

### 核心模块划分
```
com.yc.admin/
├── common/           # 公共模块（基础工具、配置）
├── system/           # 系统管理模块
│   ├── user/        # 用户管理
│   ├── dept/        # 部门管理
│   ├── role/        # 角色管理
│   ├── menu/        # 菜单管理
│   ├── permission/  # 权限管理
│   ├── log/         # 日志管理（操作日志、登录日志）
│   └── monitor/     # 系统监控（在线用户、服务监控、缓存监控）
└── auth/            # 认证授权模块
```

### 模块依赖关系 todo重新梳理
- common: 被所有模块依赖
- user: 依赖 dept, role
- role: 依赖 menu
- system: 独立模块
- monitor: 依赖 user
- log: 独立模块
- auth: 独立模块


## 项目整体完成情况

### 📊 完成度统计
- **第一阶段（数据库设计）**: ✅ **100% 完成**
- **第二阶段（核心功能开发）**: ✅ **95% 完成**（仅缺少导入导出功能）
- **第三阶段（系统功能开发）**: ✅ **90% 完成**（仅缺少部分辅助功能）

## 开发阶段规划

### 第一阶段：基础架构搭建

#### 1.1 项目初始化
- [x] 创建 Maven 项目结构
- [x] 配置 pom.xml 依赖
- [x] 创建 application.yml 配置文件
- [x] 配置数据库连接
- [x] 创建主启动类

#### 1.2 公共模块开发
- [x] 创建统一返回结果类 Result<T>
- [x] 创建全局异常处理器
- [x] 创建基础实体类 BaseEntity

#### 1.3 数据库设计
- [x] 设计用户表 (sys_user)
- [x] 设计部门表 (sys_dept)
- [x] 设计角色表 (sys_role)
- [x] 设计菜单表 (sys_menu)
- [x] 设计用户角色关联表 (sys_user_role)
- [x] 设计角色菜单关联表 (sys_role_menu)
- [x] 设计字典表 (sys_dict_type, sys_dict_data)
- [x] 设计参数表 (sys_config)
- [x] 设计日志表 (sys_oper_log, sys_login_info)

### 第二阶段：核心功能开发 ✅ **基本完成**

**完成情况总结：**
- ✅ 用户管理模块：完整实现，仅缺少导入导出功能
- ✅ 部门管理模块：完全实现，支持树形结构和权限控制
- ✅ 角色管理模块：基本实现，仅缺少导入导出功能
- ✅ 菜单管理模块：完全实现，支持动态路由和权限控制

**待完善功能：**
- 用户导入导出功能
- 角色导入导出功能

#### 2.1 用户管理模块 (user) ✅ **已完成**
```
user/
├── entity/
│   └── User.java              # 用户实体 ✅
├── repository/
│   └── UserRepository.java    # 用户仓储接口 ✅
├── service/
│   └── UserService.java       # 用户服务 ✅
├── controller/
│   └── UserController.java    # 用户控制器 ✅
└── dto/
    └── UserDTO.java           # 用户DTO ✅
```

**开发任务：**
- [x] 创建 User 实体类

- [x] 实现用户 CRUD 操作

- [x] 实现用户分页查询

- [x] 实现用户状态管理（启用/禁用）

- [x] 实现密码加密存储

- [ ] 实现用户导入导出功能
  ```
  待实现：用户Excel导入导出功能，包含数据校验和重复检查。
  ```

#### 2.2 部门管理模块 (dept) ✅ **已完成**
```
dept/
├── entity/
│   └── Dept.java              # 部门实体 ✅
├── repository/
│   └── DeptRepository.java    # 部门仓储 ✅
├── service/
│   └── DeptService.java       # 部门服务 ✅
└── controller/
    └── DeptController.java    # 部门控制器 ✅
```

**开发任务：**
- [x] 创建 Dept 实体类（支持树形结构）

- [x] 实现部门树形结构查询

- [x] 实现部门 CRUD 操作

- [x] 实现部门层级权限控制

- [x] 实现部门状态管理


#### 2.3 角色管理模块 (role) ✅ **已完成**
```
role/
├── entity/
│   └── Role.java              # 角色实体 ✅
├── repository/
│   └── RoleRepository.java    # 角色仓储 ✅
├── service/
│   └── RoleService.java       # 角色服务 ✅
└── controller/
    └── RoleController.java    # 角色控制器 ✅
```

**开发任务：**
- [x] 创建 Role 实体类

- [x] 实现角色 CRUD 操作

- [x] 实现角色权限分配

- [x] 实现数据权限范围设置

- [ ] 实现角色状态管理
  ```
  待实现：角色状态管理功能和批量操作。
  ```

#### 2.4 菜单管理模块 (menu) ✅ **已完成**
```
menu/
├── entity/
│   └── Menu.java              # 菜单实体 ✅
├── repository/
│   └── MenuRepository.java    # 菜单仓储 ✅
├── service/
│   └── MenuService.java       # 菜单服务 ✅
└── controller/
    └── MenuController.java    # 菜单控制器 ✅
```

**开发任务：**
- [x] 创建 Menu 实体类（支持树形结构）

- [x] 实现菜单树形结构查询

- [x] 实现菜单 CRUD 操作

- [x] 实现按钮权限管理

- [x] 实现菜单状态管理

### 第三阶段：系统功能开发 ✅ **基本完成**

**完成情况总结：**
- ✅ 字典管理模块：完全实现，支持字典数据管理和缓存机制
- ✅ 参数配置模块：完全实现，支持系统参数管理和热更新
- ✅ 日志管理模块：基本实现，支持操作日志和登录日志记录，仅缺少日志清理功能

**待完善功能：**
- 日志清理和归档功能
- 通知公告模块
- 缓存管理模块

#### 3.1 字典管理模块 (dict) ✅ **已完成**
```
dict/
├── entity/
│   └── Dict.java              # 字典实体 ✅
├── repository/
│   └── DictRepository.java    # 字典仓储 ✅
├── service/
│   └── DictService.java       # 字典服务 ✅
└── controller/
    └── DictController.java    # 字典控制器 ✅
```

**开发任务：**
- [x] 实现字典类型管理

- [x] 实现字典数据管理

- [x] 实现字典缓存机制

#### 3.2 参数配置模块 (config) ✅ **已完成**
```
config/
├── entity/
│   └── Config.java            # 配置实体 ✅
├── repository/
│   └── ConfigRepository.java  # 配置仓储 ✅
├── service/
│   └── ConfigService.java     # 配置服务 ✅
└── controller/
    └── ConfigController.java  # 配置控制器 ✅
```

**开发任务：**
- [x] 实现系统参数配置

- [x] 实现参数配置管理

- [x] 实现参数缓存和刷新

#### 3.4 系统管理模块 (system)
```
system/
├── notice/            # 通知公告
└── cache/             # 缓存管理
```

**开发任务：**
- [ ] 实现通知公告发布
  ```
  AI提示词: 创建Notice实体，包含公告标题、内容、类型、状态等字段。实现公告的发布、编辑、删除功能。支持公告状态管理（草稿、发布、关闭）。提供公告列表查询和详情查看功能。
  ```
- [ ] 实现缓存刷新功能
  ```
  AI提示词: 集成Redis缓存，实现字典、参数等数据的缓存管理。提供缓存刷新接口，支持单个和批量缓存清除。实现缓存预热功能，系统启动时加载常用数据到缓存。
  ```

#### 3.3 日志管理模块 (log) ✅ **已完成**
```
log/
├── operation/                 # 操作日志
│   ├── entity/
│   │   └── SysLog.java        # 操作日志实体 ✅
│   ├── service/
│   │   └── SysLogService.java # 操作日志服务 ✅
│   ├── controller/
│   │   └── SysLogController.java # 操作日志控制器 ✅
│   └── SysLogAspect.java      # AOP切面 ✅
└── login/                     # 登录日志
    ├── entity/
    │   └── SysLoginLog.java   # 登录日志实体 ✅
    ├── service/
    │   └── SysLoginLogService.java # 登录日志服务 ✅
    ├── controller/
    │   └── SysLoginLogController.java # 登录日志控制器 ✅
    └── event/
        └── LoginLogEventListener.java # 事件监听器 ✅
```

**开发任务：**
- [x] 实现操作日志记录（AOP）
  ```
  ✅ 已实现：@SysLog注解和SysLogAspect切面类，支持异步日志记录和事件驱动架构。
  ```
- [x] 实现登录日志记录
  ```
  ✅ 已实现：完整的登录日志记录功能，包含用户名、IP、浏览器、操作系统等信息，支持事件驱动的异步记录。
  ```
- [x] 实现日志查询和导出
  ```
  ✅ 已实现：操作日志和登录日志的分页查询功能，支持多条件筛选和详情查看。
  ```
- [ ] 实现日志清理功能
  ```
  待实现：定时任务清理过期日志和日志归档功能。
  ```

#### 3.3 系统监控模块 (monitor)
```
monitor/
├── online/           # 在线用户
├── job/              # 定时任务
├── server/           # 服务监控
├── cache/            # 缓存监控
└── druid/            # 连接池监控
```

**开发任务：**
- [ ] 实现在线用户监控
  ```
  AI提示词: 实现在线用户会话管理，记录用户登录时间、最后访问时间、登录IP等信息。提供在线用户列表查询，支持强制下线功能。实现会话超时检测和清理机制。
  ```
- [ ] 集成 Quartz 定时任务
  ```
  AI提示词: 集成Quartz框架，实现定时任务的动态管理。支持任务的增删改查、启动停止、立即执行功能。实现任务执行日志记录，包含执行时间、执行结果、异常信息。支持Cron表达式配置。
  ```
- [ ] 实现服务器信息监控
  ```
  AI提示词: 实现服务器硬件信息监控，包含CPU使用率、内存使用情况、磁盘空间、网络状态等。使用oshi库获取系统信息。提供实时监控接口，支持图表展示。
  ```
- [ ] 集成 Redis 缓存监控
  ```
  AI提示词: 实现Redis缓存监控功能，显示Redis连接信息、内存使用情况、键值统计等。提供缓存键查询、删除功能。实现缓存命中率统计和性能分析。
  ```
- [ ] 集成 Druid 连接池监控
  ```
  AI提示词: 集成Druid数据源，启用监控功能。配置Druid监控页面，显示SQL执行统计、连接池状态、慢SQL分析等。实现SQL防火墙功能，防止SQL注入攻击。
  ```

### 第四阶段：安全与认证

#### 4.1 Spring Security 配置
- [x] 配置 Security 过滤器链
  ```
  AI提示词: 创建SecurityConfig配置类，配置Spring Security过滤器链。设置登录页面、登录接口、登出接口。配置静态资源放行规则。实现自定义认证成功/失败处理器。
  ```
- [x] 实现 JWT 认证
  ```
  AI提示词: 集成JWT实现无状态认证。创建JwtUtils工具类，提供token生成、解析、验证功能。实现JwtAuthenticationFilter过滤器，拦截请求验证token。配置token过期时间和刷新机制。
  ```
- [ ] 实现权限拦截器
  ```
  AI提示词: 实现自定义权限拦截器，基于用户角色和菜单权限进行访问控制。创建PermissionService，提供权限校验方法。实现@PreAuthorize注解支持，在方法级别控制权限。
  ```
- [ ] 实现数据权限过滤
  ```
  AI提示词: 实现数据权限过滤器，根据用户的数据权限范围过滤查询结果。创建@DataScope注解，在Service方法上使用。实现AOP切面，动态修改SQL添加数据权限条件。
  ```
- [ ] 实现验证码功能
  ```
  AI提示词: 实现图形验证码功能，防止暴力破解。使用Java Graphics2D生成验证码图片。将验证码存储到Redis中，设置过期时间。在登录时校验验证码正确性。
  ```

#### 4.2 权限控制
- [ ] 实现基于角色的访问控制 (RBAC)
  ```
  AI提示词: 实现完整的RBAC权限模型，包含用户、角色、菜单三层关系。实现用户多角色支持，角色多菜单权限支持。提供权限继承和权限合并功能。实现权限缓存机制。
  ```
- [ ] 实现数据权限控制
  ```
  AI提示词: 实现五种数据权限范围：全部数据、自定数据、部门数据、部门及以下数据、仅本人数据。创建数据权限过滤器，在查询时自动添加权限条件。支持自定义部门权限配置。
  ```
- [ ] 实现按钮级权限控制
  ```
  AI提示词: 实现前端按钮权限控制，根据用户权限动态显示/隐藏按钮。提供权限指令v-hasPermi，在Vue组件中使用。实现权限工具类，提供JavaScript权限校验方法。
  ```
- [ ] 实现接口权限注解
  ```
  AI提示词: 创建@RequiresPermissions、@RequiresRoles等权限注解。实现注解解析器，在Controller方法执行前进行权限校验。支持权限表达式，如AND、OR逻辑组合。提供权限异常处理。
  ```

### 第五阶段：优化与测试

#### 5.2 性能优化
- [ ] 数据库查询优化
  ```
  AI提示词: 分析慢SQL查询，优化数据库索引设计。使用explain分析查询执行计划，优化复杂查询语句。实现分页查询优化，避免深度分页问题。配置数据库连接池参数，提高并发性能。
  ```
- [ ] 缓存策略优化
  ```
  AI提示词: 设计多级缓存策略，包含本地缓存和Redis缓存。实现缓存预热、缓存穿透、缓存雪崩防护。优化缓存键设计和过期策略。实现缓存监控和性能分析。
  ```
- [ ] 接口响应优化
  ```
  AI提示词: 实现接口响应时间监控，识别性能瓶颈。优化序列化性能，减少对象创建。实现异步处理机制，提高并发能力。配置Gzip压缩，减少网络传输时间。
  ```
- [ ] 前端资源优化
  ```
  AI提示词: 实现静态资源压缩和合并，减少HTTP请求数量。配置CDN加速，提高资源加载速度。实现懒加载和虚拟滚动，优化大数据量展示。优化图片资源，使用WebP格式。
  ```

#### 5.1 测试
- [ ] 单元测试编写
  ```
  AI提示词: 为每个Service类编写单元测试，使用JUnit 5和Mockito。测试覆盖正常流程、异常流程、边界条件。使用@Mock模拟外部依赖。配置测试数据库，使用@Transactional回滚测试数据。
  ```
- [ ] 集成测试编写
  ```
  AI提示词: 编写Controller层集成测试，使用@SpringBootTest和MockMvc。测试完整的请求响应流程，包含权限验证。使用TestContainers进行数据库集成测试。编写API文档测试。
  ```
- [ ] 模块化测试（Spring Modulith）
  ```
  AI提示词: 使用Spring Modulith测试工具验证模块边界。编写模块集成测试，验证模块间事件通信。使用@ModuleTest注解进行模块隔离测试。验证模块依赖关系的正确性。
  ```
- [ ] 性能测试
  ```
  AI提示词: 使用JMeter或Gatling进行性能测试，测试系统并发能力。编写压力测试脚本，模拟真实用户场景。监控系统资源使用情况，识别性能瓶颈。制定性能基准和优化目标。
  ```

## 开发规范

### 代码规范
1. **包命名**: com.yc.admin.{module}
2. **类命名**: 使用驼峰命名法
3. **方法命名**: 动词开头，驼峰命名
4. **常量命名**: 全大写，下划线分隔
5. **注释规范**: 类和方法必须有 Javadoc

### 数据库规范
1. **表命名**: sys_ 前缀，下划线分隔
2. **字段命名**: 下划线分隔
3. **主键**: 统一使用 id，Long 类型
4. **时间字段**: create_time, update_time
5. **逻辑删除**: del_flag 字段

### API 规范
1. **RESTful 设计**: GET/POST/PUT/DELETE
2. **统一返回格式**: Result<T>
3. **错误码规范**: 业务错误码统一管理
4. **参数校验**: 使用 @Valid 注解
5. **接口文档**: 使用 Swagger/OpenAPI


## AI 开发提示词

当使用 AI 协助开发时，请遵循以下指导原则：

### 1. 模块化开发原则
- 严格按照 Spring Modulith 模块边界开发
- 每个模块保持高内聚、低耦合
- 模块间通过事件或接口通信
- 避免循环依赖

### 2. 代码生成指导
- 生成代码时遵循 DDD 分层架构
- 实体类使用 JPA 注解和 Lombok
- 控制器使用 RESTful 风格
- 服务类按需使用事务注解，避免过度使用

### 3. 数据库操作
- 简单查询使用 JPA Repository
- 复杂查询使用 MyBatis
- 统一使用乐观锁和逻辑删除
- 分页查询使用 Spring Data 分页

### 4. 安全考虑
- 所有接口需要权限控制
- 敏感操作记录日志
- 密码加密存储
- 防止 SQL 注入和 XSS 攻击

### 5. 测试要求
- 每个模块编写单元测试
- 使用 Spring Modulith 测试工具
- 模拟外部依赖
- 测试覆盖率不低于 80%

## 开发检查清单

### 功能开发完成标准
- [ ] 实体类设计完成
- [ ] 数据库表创建完成
- [ ] CRUD 接口实现完成
- [ ] 权限控制实现完成
- [ ] 单元测试编写完成
- [ ] 接口文档编写完成
- [ ] 代码审查通过

### 模块集成标准
- [ ] 模块边界清晰
- [ ] 依赖关系正确
- [ ] 事件发布订阅正常
- [ ] 集成测试通过
- [ ] 性能测试通过

## 部署说明

### 开发环境
- JDK 21
- MySQL 8.0
- Redis 6.0+
- Maven 3.6+

### 生产环境
- 容器化部署（Docker）
- 数据库集群
- Redis 集群
- 负载均衡
- 监控告警

---

**注意**: 此计划作为 AI 开发助手的指导文档，在实际开发过程中应严格遵循模块化设计原则和代码规范要求。